<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>ActiveInteraction by orgsync</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/orgsync/active_interaction">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/orgsync/active_interaction/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/orgsync/active_interaction/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>ActiveInteraction</h1>
          <p>Manage application specific business logic.</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/orgsync">orgsync</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <p><a href="http://rubygems.org/gems/active_interaction" title="Gem Version"><img src="https://img.shields.io/gem/v/active_interaction.svg?style=flat" alt="Gem Version"></a>
<a href="https://travis-ci.org/orgsync/active_interaction" title="Build Status"><img src="https://img.shields.io/travis/orgsync/active_interaction/master.svg?style=flat" alt="Build Status"></a>
<a href="https://coveralls.io/r/orgsync/active_interaction?branch=master" title="Coverage Status"><img src="https://img.shields.io/coveralls/orgsync/active_interaction/master.svg?style=flat" alt="Coverage Status"></a>
<a href="https://codeclimate.com/github/orgsync/active_interaction" title="Code Climate"><img src="https://img.shields.io/codeclimate/github/orgsync/active_interaction.svg?style=flat" alt="Code Climate"></a>
<a href="https://gemnasium.com/orgsync/active_interaction" title="Dependency Status"><img src="https://img.shields.io/gemnasium/orgsync/active_interaction.svg?style=flat" alt="Dependency Status"></a></p>

<p>At first it seemed alright. A little business logic in a controller
or model wasn't going to hurt anything. Then one day you wake up
and you're surrounded by fat models and unwieldy controllers. Curled
up and crying in the corner, you can't help but wonder how it came
to this.</p>

<p>Take back control. Slim down models and wrangle monstrous controller
methods with ActiveInteraction.</p>

<p>Read more on the <a href="http://orgsync.github.io/active_interaction/">project page</a> or check out the full <a href="http://rubydoc.info/github/orgsync/active_interaction">documentation</a>
on RubyDoc.info.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>This project uses <a href="http://semver.org/spec/v2.0.0.html">semantic versioning</a>.</p>

<p>Add it to your Gemfile:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">gem</span> <span class="pl-s1"><span class="pl-pds">'</span>active_interaction<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>~&gt; 1.4<span class="pl-pds">'</span></span></pre></div>

<p>And then execute:</p>

<div class="highlight highlight-sh"><pre>$ bundle</pre></div>

<p>Or install it yourself with:</p>

<div class="highlight highlight-sh"><pre>$ gem install active_interaction</pre></div>

<h2>
<a id="what-do-i-get" class="anchor" href="#what-do-i-get" aria-hidden="true"><span class="octicon octicon-link"></span></a>What do I get?</h2>

<p>ActiveInteraction::Base lets you create interaction models. These
models ensure that certain inputs are provided and that those
inputs are in the format you want them in. If the inputs are valid
it will call <code>execute</code>, store the return value of that method in
<code>result</code>, and return an instance of your ActiveInteraction::Base
subclass. Let's look at a simple example:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c"># Define an interaction that signs up a user.</span>
<span class="pl-k">class</span> <span class="pl-en">UserSignup<span class="pl-e"> &lt; ActiveInteraction::Base</span></span>
  <span class="pl-c"># required</span>
  string <span class="pl-c1">:email</span>, <span class="pl-c1">:name</span>

  <span class="pl-c"># optional</span>
  boolean <span class="pl-c1">:newsletter_subscribe</span>, <span class="pl-c1">default:</span> <span class="pl-c1">nil</span>

  <span class="pl-c"># ActiveRecord validations</span>
  validates <span class="pl-c1">:email</span>, <span class="pl-c1">format:</span> <span class="pl-vo">EMAIL_REGEX</span>

  <span class="pl-c"># The execute method is called only if the inputs validate. It</span>
  <span class="pl-c"># does your business action. The return value will be stored in</span>
  <span class="pl-c"># `result`.</span>
  <span class="pl-k">def</span> <span class="pl-en">execute</span>
    user <span class="pl-k">=</span> <span class="pl-s3">User</span>.create!(<span class="pl-c1">email:</span> email, <span class="pl-c1">name:</span> name)
    <span class="pl-k">if</span> newsletter_subscribe
      <span class="pl-s3">NewsletterSubscriptions</span>.create(<span class="pl-c1">email:</span> email, <span class="pl-c1">user_id:</span> user.id)
    <span class="pl-k">end</span>
    <span class="pl-s3">UserMailer</span>.async(<span class="pl-c1">:deliver_welcome</span>, user.id)
    user
  <span class="pl-k">end</span>
<span class="pl-k">end</span>

<span class="pl-c"># In a controller action (for instance), you can run it:</span>
<span class="pl-k">def</span> <span class="pl-en">new</span>
  <span class="pl-vo">@signup</span> <span class="pl-k">=</span> <span class="pl-s3">UserSignup</span>.<span class="pl-k">new</span>
<span class="pl-k">end</span>

<span class="pl-k">def</span> <span class="pl-en">create</span>
  <span class="pl-vo">@signup</span> <span class="pl-k">=</span> <span class="pl-s3">UserSignup</span>.run(params[<span class="pl-c1">:user</span>])

  <span class="pl-c"># Then check to see if it worked:</span>
  <span class="pl-k">if</span> <span class="pl-vo">@signup</span>.valid?
    redirect_to welcome_path(<span class="pl-c1">user_id:</span> signup.result.id)
  <span class="pl-k">else</span>
    render <span class="pl-c1">action:</span> <span class="pl-c1">:new</span>
  <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<p>You may have noticed that ActiveInteraction::Base quacks like
ActiveRecord::Base. It can use validations from your Rails application
and check option validity with <code>valid?</code>. Any errors are added to
<code>errors</code> which works exactly like an ActiveRecord model. By default,
everything within the <code>execute</code> method is run in a transaction if
ActiveRecord is available.</p>

<h2>
<a id="how-do-i-call-an-interaction" class="anchor" href="#how-do-i-call-an-interaction" aria-hidden="true"><span class="octicon octicon-link"></span></a>How do I call an interaction?</h2>

<p>There are two way to call an interaction. Given UserSignup, you can
do this:</p>

<div class="highlight highlight-ruby"><pre>outcome <span class="pl-k">=</span> <span class="pl-s3">UserSignup</span>.run(params)
<span class="pl-k">if</span> outcome.valid?
  <span class="pl-c"># Do something with outcome.result...</span>
<span class="pl-k">else</span>
  <span class="pl-c"># Do something with outcome.errors...</span>
<span class="pl-k">end</span></pre></div>

<p>Or, you can do this:</p>

<div class="highlight highlight-ruby"><pre>result <span class="pl-k">=</span> <span class="pl-s3">UserSignup</span>.run!(params)
<span class="pl-c"># Either returns the result of execute,</span>
<span class="pl-c"># or raises ActiveInteraction::InvalidInteractionError</span></pre></div>

<h2>
<a id="what-can-i-pass-to-an-interaction" class="anchor" href="#what-can-i-pass-to-an-interaction" aria-hidden="true"><span class="octicon octicon-link"></span></a>What can I pass to an interaction?</h2>

<p>Interactions only accept a Hash for <code>run</code> and <code>run!</code>.</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c"># A user comments on an article</span>
<span class="pl-k">class</span> <span class="pl-en">CreateComment<span class="pl-e"> &lt; ActiveInteraction::Base</span></span>
  model <span class="pl-c1">:article</span>, <span class="pl-c1">:user</span>
  string <span class="pl-c1">:comment</span>

  validates <span class="pl-c1">:comment</span>, <span class="pl-c1">length:</span> { <span class="pl-c1">maximum:</span> <span class="pl-c1">500</span> }

  <span class="pl-k">def</span> <span class="pl-en">execute</span>; ...; <span class="pl-k">end</span>
<span class="pl-k">end</span>

<span class="pl-k">def</span> <span class="pl-en">somewhere</span>
  outcome <span class="pl-k">=</span> <span class="pl-s3">CreateComment</span>.run(
    <span class="pl-c1">comment:</span> params[<span class="pl-c1">:comment</span>],
    <span class="pl-c1">article:</span> <span class="pl-s3">Article</span>.find(params[<span class="pl-c1">:article_id</span>]),
    <span class="pl-c1">user:</span> current_user
  )
<span class="pl-k">end</span></pre></div>

<h2>
<a id="how-do-i-define-an-interaction" class="anchor" href="#how-do-i-define-an-interaction" aria-hidden="true"><span class="octicon octicon-link"></span></a>How do I define an interaction?</h2>

<ol>
<li>
<p>Subclass ActiveInteraction::Base</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">YourInteraction<span class="pl-e"> &lt; ActiveInteraction::Base</span></span>
  <span class="pl-c"># ...</span>
<span class="pl-k">end</span></pre></div>
</li>
<li>
<p>Define your attributes:</p>

<div class="highlight highlight-ruby"><pre>string <span class="pl-c1">:name</span>, <span class="pl-c1">:state</span>
integer <span class="pl-c1">:age</span>
boolean <span class="pl-c1">:is_special</span>
model <span class="pl-c1">:account</span>
array <span class="pl-c1">:tags</span>, <span class="pl-c1">default:</span> <span class="pl-c1">nil</span> <span class="pl-k">do</span>
  string
<span class="pl-k">end</span>
hash <span class="pl-c1">:prefs</span>, <span class="pl-c1">default:</span> <span class="pl-c1">nil</span> <span class="pl-k">do</span>
  boolean <span class="pl-c1">:smoking</span>
  boolean <span class="pl-c1">:view</span>
<span class="pl-k">end</span>
date <span class="pl-c1">:arrives_on</span>, <span class="pl-c1">default:</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> { <span class="pl-s3">Date</span>.current }
date <span class="pl-c1">:departs_on</span>, <span class="pl-c1">default:</span> <span class="pl-k">-</span><span class="pl-k">&gt;</span> { <span class="pl-s3">Date</span>.tomorrow }</pre></div>
</li>
<li>
<p>Use any additional validations you need:</p>

<div class="highlight highlight-ruby"><pre>validates <span class="pl-c1">:name</span>, <span class="pl-c1">length:</span> { <span class="pl-c1">maximum:</span> <span class="pl-c1">10</span> }
validates <span class="pl-c1">:state</span>, <span class="pl-c1">inclusion:</span> { <span class="pl-c1">in:</span> <span class="pl-s1"><span class="pl-pds">%w(</span>AL AK AR ... WY<span class="pl-pds">)</span></span> }
validate <span class="pl-c1">:arrives_before_departs</span>

<span class="pl-k">private</span>

<span class="pl-k">def</span> <span class="pl-en">arrive_before_departs</span>
  <span class="pl-k">if</span> departs_on <span class="pl-k">&lt;=</span> arrives_on
    errors.add(<span class="pl-c1">:departs_on</span>, <span class="pl-s1"><span class="pl-pds">'</span>must come after the arrival time<span class="pl-pds">'</span></span>)
  <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>
</li>
<li>
<p>Define your execute method. It can return whatever you like:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">def</span> <span class="pl-en">execute</span>
  record <span class="pl-k">=</span> do_thing(...)
  <span class="pl-c"># ...</span>
  record
<span class="pl-k">end</span></pre></div>
</li>
</ol>

<p>Check out the <a href="http://rubydoc.info/github/orgsync/active_interaction">documentation</a> for a full list of methods.</p>

<h2>
<a id="how-do-i-compose-interactions" class="anchor" href="#how-do-i-compose-interactions" aria-hidden="true"><span class="octicon octicon-link"></span></a>How do I compose interactions?</h2>

<p>You can run interactions from within other interactions by calling <code>compose</code>.
If the interaction is successful, it'll return the result (just like if you had
called it with <code>run!</code>). If something went wrong, execution will halt
immediately and the errors will be moved onto the caller.</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">AddThree<span class="pl-e"> &lt; ActiveInteraction::Base</span></span>
  integer <span class="pl-c1">:x</span>
  <span class="pl-k">def</span> <span class="pl-en">execute</span>
    compose(<span class="pl-vo">Add</span>, <span class="pl-c1">x:</span> x, <span class="pl-c1">y:</span> <span class="pl-c1">3</span>)
  <span class="pl-k">end</span>
<span class="pl-k">end</span>
<span class="pl-s3">AddThree</span>.run!(<span class="pl-c1">x:</span> <span class="pl-c1">5</span>)
<span class="pl-c"># =&gt; 8</span></pre></div>

<p>To bring in filters from another interaction, use <code>import_filters</code>. Combined
with <code>inputs</code>, delegating to another interaction is a piece of cake.</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">AddAndDouble<span class="pl-e"> &lt; ActiveInteraction::Base</span></span>
  import_filters <span class="pl-vo">Add</span>
  <span class="pl-k">def</span> <span class="pl-en">execute</span>
    compose(<span class="pl-vo">Add</span>, inputs) <span class="pl-k">*</span> <span class="pl-c1">2</span>
  <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<h2>
<a id="how-do-i-translate-an-interaction" class="anchor" href="#how-do-i-translate-an-interaction" aria-hidden="true"><span class="octicon octicon-link"></span></a>How do I translate an interaction?</h2>

<p>ActiveInteraction is i18n-aware out of the box! All you have to do
is add translations to your project. In Rails, they typically go
into <code>config/locales</code>. So, for example, let's say that (for whatever
reason) you want to print out everything backwards. Simply add
translations for ActiveInteraction to your <code>hsilgne</code> locale:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c"># config/locales/hsilgne.yml</span>
<span class="pl-c1">hsilgne:</span>
  <span class="pl-c1">active_interaction:</span>
    <span class="pl-c1">types:</span>
      <span class="pl-c1">array:</span> yarra
      <span class="pl-c1">boolean:</span> naeloob
      <span class="pl-c1">date:</span> etad
      <span class="pl-c1">date_time:</span> emit etad
      <span class="pl-c1">decimal:</span> lamiced
      <span class="pl-c1">file:</span> elif
      <span class="pl-c1">float:</span> taolf
      <span class="pl-c1">hash:</span> hsah
      <span class="pl-c1">integer:</span> regetni
      <span class="pl-c1">model:</span> ledom
      <span class="pl-c1">string:</span> gnirts
      <span class="pl-c1">time:</span> emit
    <span class="pl-c1">errors:</span>
      <span class="pl-c1">messages:</span>
        <span class="pl-c1">invalid:</span> dilavni si
        <span class="pl-c1">invalid_type:</span> <span class="pl-s1"><span class="pl-pds">'</span>%{type} dilav a ton si<span class="pl-pds">'</span></span>
        <span class="pl-c1">missing:</span> deriuqer si</pre></div>

<p>Then set your locale and run an interaction like normal:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-s3">I18n</span>.locale <span class="pl-k">=</span> <span class="pl-c1">:hsilgne</span>
<span class="pl-k">class</span> <span class="pl-en">Interaction<span class="pl-e"> &lt; ActiveInteraction::Base</span></span>
  boolean <span class="pl-c1">:a</span>
  <span class="pl-k">def</span> <span class="pl-en">execute</span>; <span class="pl-k">end</span>
<span class="pl-k">end</span>
p <span class="pl-s3">Interaction</span>.run.errors.messages
<span class="pl-c"># =&gt; {:a=&gt;["deriuqer si"]}</span></pre></div>

<h2>
<a id="credits" class="anchor" href="#credits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Credits</h2>

<p>ActiveInteraction is brought to you by <a href="https://github.com/AaronLasseigne">@AaronLasseigne</a> and
<a href="https://github.com/tfausak">@tfausak</a> from <a href="https://github.com/orgsync">@orgsync</a>. We were inspired by the fantastic
work done in <a href="https://github.com/cypriss/mutations">Mutations</a>.</p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>